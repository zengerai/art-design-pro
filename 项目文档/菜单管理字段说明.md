# 菜单管理字段说明文档

## 📋 目录

- [一、菜单类型选择](#一菜单类型选择)
- [二、菜单字段说明](#二菜单字段说明)
  - [2.1 必填字段](#21-必填字段)
  - [2.2 路径配置字段](#22-路径配置字段)
  - [2.3 显示控制字段](#23-显示控制字段)
  - [2.4 高级功能字段](#24-高级功能字段)
  - [2.5 权限控制字段](#25-权限控制字段)
- [三、实际示例](#三实际示例)
  - [3.1 一级菜单示例：区块链](#31-一级菜单示例区块链)
  - [3.2 二级菜单示例：钱包管理](#32-二级菜单示例钱包管理)
  - [3.3 目录菜单示例](#33-目录菜单示例)
  - [3.4 外部链接示例](#34-外部链接示例)
  - [3.5 内嵌页面示例](#35-内嵌页面示例)
- [四、后端验证规则](#四后端验证规则)
- [五、常见问题](#五常见问题)

---

## 一、菜单类型选择

在"新建菜单"窗口的最顶部，首先需要选择菜单类型：

### 1. 菜单（menu）

- **用途**: 创建可点击跳转的菜单项，包括目录菜单、页面菜单、外部链接等
- **特点**: 会在侧边栏显示，可以有子菜单

### 2. 按钮（button）

- **用途**: 创建页面内的操作权限标识（如"新增"、"编辑"、"删除"按钮）
- **特点**: 不显示在菜单栏，用于控制页面内按钮的权限
- **字段**: 权限名称、权限标识、权限排序

---

## 二、菜单字段说明

### 2.1 必填字段

### 1. **菜单标题** (前端表单显示为"菜单名称")

- **前端表单字段**: `name`
- **数据库字段**: `title` (VARCHAR 100)
- **作用**: 菜单显示的标题文本
- **验证规则**:
  - ✅ 必填
  - ✅ 2-100个字符
- **填写建议**:
  - 使用中文或国际化键名
  - 简洁明了，便于用户理解
- **后端是否生效**: ✅ **生效** - 存储在数据库 `title` 字段
- **示例**:
  - 正确: `区块链`、`钱包管理`、`用户中心`
  - 也可使用国际化键名: `menus.blockchain.title`

#### 3. **路由地址** (path)

- **数据库字段**: `path` (VARCHAR 255)
- **作用**: 前端路由路径，决定浏览器地址栏 URL
- **验证规则**: ✅ 必填
- **填写规则**:
  - **一级菜单**: 必须以 `/` 开头的绝对路径（如 `/blockchain`）
  - **二级及以下菜单**: 使用相对路径（如 `wallet`, `transaction`）
  - **目录菜单**: 同样需要路径（如 `/system`）
- **后端是否生效**: ✅ **生效** - 存储在数据库，构建前端路由使用
- **示例**:
  ```
  一级菜单: /blockchain
  二级菜单: wallet（完整路径为 /blockchain/wallet）
  三级菜单: detail（完整路径为 /blockchain/wallet/detail）
  ```

### 2. **路由名称** (前端表单显示为"权限标识")

- **前端表单字段**: `label`
- **数据库字段**: `name` (VARCHAR 100)
- **作用**: 路由的唯一标识符，用于 Vue Router 的 `name` 属性和权限控制
- **验证规则**:
  - ✅ 必填
  - ✅ 2-20个字符
  - ✅ 全局唯一（数据库约束）
- **填写建议**:
  - 使用英文、采用 PascalCase 命名（如 `Blockchain`, `WalletManage`）
  - 不能与其他菜单重复
  - 这是菜单的真正唯一标识
- **后端是否生效**: ✅ **生效** - 作为路由唯一标识存储在数据库 `name` 字段
- **示例**:
  - 正确: `Blockchain`, `UserCenter`, `WalletManage`
  - 错误: `区块链` (应用英文), `user-center` (应用 PascalCase)

---

### 2.2 路径配置字段

#### 4. **组件路径** (component)

- **数据库字段**: `component` (VARCHAR 255)
- **作用**: 指定该路由对应的 Vue 组件文件路径
- **验证规则**: ❌ 非必填
- **填写规则**:
  - **一级父级菜单**: 填写 `/index/index`（固定值）
  - **具体页面**: 填写相对于 `src/views/` 的组件路径（如 `/blockchain/wallet`）
  - **目录菜单**: 留空（只做分组不加载组件）
- **后端是否生效**: ✅ **生效** - 存储在数据库，前端路由加载组件时使用
- **示例**:
  ```
  一级菜单（有首页）: /index/index
  具体页面: /blockchain/wallet
  目录菜单: 留空
  ```

#### 5. **外部链接** (link)

- **数据库字段**: `link` (VARCHAR 500)
- **作用**: 配置外部链接 URL，点击菜单时跳转到外部网站
- **验证规则**: ❌ 非必填
- **后端是否生效**: ✅ **生效** - 存储在数据库
- **配合字段**: 需配合 "是否内嵌" 字段使用
- **示例**: `https://www.blockchain.com`

#### 6. **激活路径** (activePath)

- **数据库字段**: `active_path` (VARCHAR 255)
- **作用**: 用于详情页等隐藏菜单，指定高亮显示的父级菜单路径
- **验证规则**: ❌ 非必填
- **使用场景**: 详情页隐藏在菜单中，但希望高亮显示其父级菜单
- **后端是否生效**: ✅ **生效** - 存储在数据库
- **示例**: `/blockchain/wallet`（在钱包详情页高亮显示"钱包管理"菜单）

---

### 2.3 显示控制字段

#### 7. **图标** (icon)

- **数据库字段**: `icon` (VARCHAR 100)
- **作用**: 菜单项显示的图标
- **验证规则**: ❌ 非必填
- **格式**: 使用 Remix Icon 或 Element Plus Icon 图标名称
- **后端是否生效**: ✅ **生效** - 存储在数据库的 `icon` 字段
- **示例**:
  - `ri:bitcoin-line`（比特币图标）
  - `ri:wallet-3-line`（钱包图标）
  - `ri:user-line`（用户图标）

#### 8. **菜单排序** (sort)

- **数据库字段**: `sort` (INT)
- **作用**: 控制菜单在同级中的显示顺序
- **验证规则**: ❌ 非必填
- **默认值**: 1
- **规则**: 数字越小越靠前
- **后端是否生效**: ✅ **生效** - 存储在数据库，查询时按此排序
- **示例**:
  ```
  首页: 1
  区块链: 2
  系统管理: 99
  ```

#### 9. **文本徽章** (showTextBadge)

- **数据库字段**: `show_text_badge` (VARCHAR 50)
- **作用**: 在菜单项右侧显示文本标签（如 "New"、"Hot"）
- **验证规则**: ❌ 非必填
- **后端是否生效**: ✅ **生效** - 存储在数据库
- **示例**: `New`, `Hot`, `Beta`

---

### 2.4 高级功能字段（开关类型）

#### 10. **是否启用** (isEnable)

- **数据库字段**: `enabled` (TINYINT)
- **作用**: 控制菜单是否启用
- **默认值**: ✅ 启用 (true → 1)
- **后端是否生效**: ✅ **生效** - 存储在数据库，查询时可过滤
- **效果**: 禁用后该菜单及其子菜单不会显示

#### 11. **页面缓存** (keepAlive)

- **数据库字段**: `keep_alive` (TINYINT)
- **作用**: 控制页面组件是否缓存（使用 Vue 的 keep-alive）
- **默认值**: ✅ 启用 (true → 1)
- **后端是否生效**: ✅ **生效** - 存储在数据库
- **效果**: 启用后切换页面时会保留页面状态（如表单输入、滚动位置等）

#### 12. **隐藏菜单** (isHide)

- **数据库字段**: `is_hide` (TINYINT)
- **作用**: 控制菜单是否在侧边栏显示
- **默认值**: ❌ 不隐藏 (false → 0)
- **后端是否生效**: ✅ **生效** - 存储在数据库
- **使用场景**: 详情页、编辑页等不需要在菜单中显示的页面

#### 13. **标签隐藏** (isHideTab)

- **数据库字段**: `is_hide_tab` (TINYINT)
- **作用**: 控制页面是否在标签栏显示
- **默认值**: ❌ 不隐藏 (false → 0)
- **后端是否生效**: ✅ **生效** - 存储在数据库

#### 14. **是否内嵌** (isIframe)

- **数据库字段**: `is_iframe` (TINYINT)
- **作用**: 控制外部链接是否以 iframe 方式内嵌显示
- **默认值**: ❌ 不内嵌 (false → 0)
- **后端是否生效**: ✅ **生效** - 存储在数据库
- **配合字段**: 需配合 "外部链接" 字段使用
- **效果**:
  - ✅ 启用: 在当前系统内嵌显示外部网页
  - ❌ 禁用: 在新窗口打开外部链接

#### 15. **显示徽章** (showBadge)

- **数据库字段**: `show_badge` (TINYINT)
- **作用**: 控制是否在菜单项显示圆点徽章
- **默认值**: ❌ 不显示 (false → 0)
- **后端是否生效**: ✅ **生效** - 存储在数据库

#### 16. **固定标签** (fixedTab)

- **数据库字段**: `fixed_tab` (TINYINT)
- **作用**: 控制页面标签页是否固定（不可关闭）
- **默认值**: ❌ 不固定 (false → 0)
- **后端是否生效**: ✅ **生效** - 存储在数据库
- **使用场景**: 首页、工作台等重要页面

#### 17. **全屏页面** (isFullPage)

- **数据库字段**: `is_full_page` (TINYINT)
- **作用**: 控制页面是否全屏显示（隐藏侧边栏、顶栏）
- **默认值**: ❌ 不全屏 (false → 0)
- **后端是否生效**: ✅ **生效** - 存储在数据库

---

### 2.5 权限控制字段

#### 18. **角色权限** (roles)

- **数据库表**: `menu_roles` 关联表
- **作用**: 配置哪些角色可以访问该菜单
- **验证规则**: ❌ 非必填
- **格式**: 角色标识数组（如 `R_SUPER`, `R_ADMIN`）
- **权限模式**:
  - **前端权限模式**: 需要配置角色标识
  - **后端权限模式**: 由后端返回用户可访问的菜单，前端无需配置
- **后端是否生效**: ✅ **生效** - 存储在 `menu_roles` 关联表
- **示例**: `R_SUPER`, `R_ADMIN`（输入后按回车添加）

---

## 三、实际示例

### 3.1 一级菜单示例：区块链

**场景**: 创建一个名为"区块链"的一级菜单

```yaml
菜单类型: 菜单
菜单名称: 区块链 # 必填，显示标题（存储到 title 字段）
路由地址: /blockchain # 必填，一级菜单以 / 开头
权限标识: Blockchain # 必填，唯一标识（存储到 name 字段）
组件路径: /index/index # 一级父级菜单固定填此值
图标: ri:bitcoin-line # 可选
菜单排序: 2 # 可选，控制显示顺序
角色权限: （可以留空） # 推荐在角色管理页面配置

# 其他开关字段保持默认即可
是否启用: ✅
页面缓存: ✅
隐藏菜单: ❌
标签隐藏: ❌
是否内嵌: ❌
显示徽章: ❌
固定标签: ❌
全屏页面: ❌
```

**后端存储**:

```sql
-- menus 表记录
title = '区块链'                -- 中文标题
name = 'Blockchain'             -- 英文唯一标识（全局唯一）
path = '/blockchain'
component = '/index/index'
icon = 'ri:bitcoin-line'
sort = 2
enabled = 1
```

**验证结果**:

- ✅ `title` 字段存储 "区块链"（中文标题）
- ✅ `name` 字段存储 "Blockchain"（唯一标识，全局唯一性检查通过）
- ✅ `path` 字段存储 "/blockchain"
- ✅ `component` 字段存储 "/index/index"
- ✅ `icon` 字段存储 "ri:bitcoin-line"
- ✅ `sort` 字段存储 2

---

### 3.2 二级菜单示例：钱包管理

**场景**: 在"区块链"菜单下创建"钱包管理"子菜单

```yaml
菜单类型: 菜单
菜单名称: 钱包管理 # 必填，显示标题（存储到 title 字段）
路由地址: wallet # 必填，二级菜单使用相对路径
权限标识: WalletManage # 必填，唯一标识（存储到 name 字段）
组件路径: /blockchain/wallet # 具体页面路径
图标: ri:wallet-3-line # 可选
菜单排序: 1 # 可选
外部链接: （留空） # 不是外部链接
文本徽章: New # 可选，显示"New"标签

是否启用: ✅
页面缓存: ✅ # 启用缓存，切换页面时保留状态
隐藏菜单: ❌
标签隐藏: ❌
是否内嵌: ❌
显示徽章: ❌
固定标签: ❌
全屏页面: ❌
```

**后端存储**:

```sql
-- menus 表记录
title = '钱包管理'              -- 中文标题
name = 'WalletManage'           -- 英文唯一标识
path = 'wallet'                 -- 相对路径
component = '/blockchain/wallet'
icon = 'ri:wallet-3-line'
sort = 1
keep_alive = 1
show_text_badge = 'New'
parent_id = 7                   -- 指向父菜单（区块链）的ID
```

**验证结果**:

- ✅ `title` 存储 "钱包管理"（中文标题）
- ✅ `name` 存储 "WalletManage"（唯一标识，全局唯一性检查通过）
- ✅ `path` 存储 "wallet"
- ✅ `component` 存储 "/blockchain/wallet"
- ✅ `keep_alive` 存储 1（启用缓存）
- ✅ `show_text_badge` 存储 "New"
- ✅ **完整路径**: `/blockchain/wallet`（父路径 + 子路径）

---

### 3.3 目录菜单示例

**场景**: 创建一个只做分组不加载页面的目录菜单

```yaml
菜单类型: 菜单
菜单名称: 区块链工具 # 必填，显示标题（存储到 title 字段）
路由地址: /blockchain-tools # 必填
权限标识: BlockchainTools # 必填，唯一标识（存储到 name 字段）
组件路径: （留空） # 目录菜单不需要组件
图标: ri:tools-line # 可选
菜单排序: 3 # 可选

是否启用: ✅
页面缓存: ❌ # 目录不需要缓存
隐藏菜单: ❌
标签隐藏: ✅ # 目录不显示标签页
```

**后端存储**:

```sql
-- menus 表记录
title = '区块链工具'            -- 中文标题
name = 'BlockchainTools'        -- 英文唯一标识
path = '/blockchain-tools'
component = NULL                -- 目录菜单不需要组件
icon = 'ri:tools-line'
sort = 3
is_hide_tab = 1                 -- 目录不显示标签页
```

**验证结果**:

- ✅ `title` 存储 "区块链工具"（中文标题）
- ✅ `name` 存储 "BlockchainTools"（唯一标识）
- ✅ `component` 字段为 NULL（目录菜单不需要组件）
- ✅ `is_hide_tab` 存储 1（不显示标签页）

---

### 3.4 外部链接示例

**场景**: 创建一个跳转到区块链浏览器的外部链接

```yaml
菜单类型: 菜单
菜单名称: 区块链浏览器 # 必填，显示标题（存储到 title 字段）
路由地址: /explorer # 必填
权限标识: BlockchainExplorer # 必填，唯一标识（存储到 name 字段）
组件路径: （留空） # 外部链接不需要组件
图标: ri:external-link-line # 可选
外部链接: https://etherscan.io # 必填，外部链接 URL

是否启用: ✅
是否内嵌: ❌ # 不内嵌，在新窗口打开
```

**后端存储**:

```sql
-- menus 表记录
title = '区块链浏览器'          -- 中文标题
name = 'BlockchainExplorer'     -- 英文唯一标识
path = '/explorer'
component = NULL                -- 外部链接不需要组件
icon = 'ri:external-link-line'
link = 'https://etherscan.io'
is_iframe = 0                   -- 新窗口打开
```

**验证结果**:

- ✅ `title` 存储 "区块链浏览器"（中文标题）
- ✅ `name` 存储 "BlockchainExplorer"（唯一标识）
- ✅ `link` 字段存储 "https://etherscan.io"
- ✅ `is_iframe` 存储 0（在新窗口打开）

---

### 3.5 内嵌页面示例

**场景**: 在系统内嵌显示外部文档

```yaml
菜单类型: 菜单
菜单名称: 区块链文档 # 必填，显示标题（存储到 title 字段）
路由地址: /docs # 必填
权限标识: BlockchainDocs # 必填，唯一标识（存储到 name 字段）
组件路径: （留空） # 内嵌页面不需要组件
图标: ri:file-text-line # 可选
外部链接: https://docs.blockchain.com # 必填

是否启用: ✅
是否内嵌: ✅ # 启用内嵌，在系统内显示
页面缓存: ✅ # 可缓存 iframe
```

**后端存储**:

```sql
-- menus 表记录
title = '区块链文档'            -- 中文标题
name = 'BlockchainDocs'         -- 英文唯一标识
path = '/docs'
component = NULL                -- 内嵌页面不需要组件
icon = 'ri:file-text-line'
link = 'https://docs.blockchain.com'
is_iframe = 1                   -- 在系统内嵌显示
keep_alive = 1                  -- 可缓存 iframe
```

**验证结果**:

- ✅ `title` 存储 "区块链文档"（中文标题）
- ✅ `name` 存储 "BlockchainDocs"（唯一标识）
- ✅ `link` 字段存储 "https://docs.blockchain.com"
- ✅ `is_iframe` 存储 1（在系统内嵌显示）
- ✅ `keep_alive` 存储 1（缓存 iframe 页面）

---

## 四、后端验证规则

### 4.1 必填字段验证（后端强制）

```javascript
// 后端验证代码片段（menu.controller.ts 第 223-224 行）
if (!menuData.menuType || !menuData.name || !menuData.title) {
  throw createError('缺少必填字段：menuType, name, title', 400)
}
```

**验证项**:

- ✅ `menuType`: 必须是 "menu" 或 "button"
- ✅ `name`: 必填，2-20个字符（对应前端表单的"权限标识"，存储英文路由名称）
- ✅ `title`: 必填，2-100个字符（对应前端表单的"菜单名称"，存储中文标题）

### 4.2 唯一性验证（后端强制）

```javascript
// 后端验证代码片段（menu.controller.ts 第 228-234 行）
const [existingMenu] = await connection.execute('SELECT id FROM menus WHERE name = ?', [
  menuData.name
])
if (existingMenu.length > 0) {
  throw createError(`菜单名称 ${menuData.name} 已存在`, 400)
}
```

**验证项**:

- ✅ `name` 字段全局唯一（数据库唯一索引约束）

### 4.3 权限验证（后端强制）

```javascript
// 后端验证代码片段（menu.controller.ts 第 216-218 行）
if (req.user?.role !== 'admin') {
  throw createError('无权限执行此操作', 403)
}
```

**验证项**:

- ✅ 仅管理员（role = 'admin'）可创建/编辑/删除菜单

### 4.4 数据转换规则（后端自动处理）

后端会自动进行以下转换：

1. **驼峰转下划线**: `camelCase → snake_case`

   ```javascript
   isHide → is_hide
   keepAlive → keep_alive
   ```

2. **布尔值转整数**: `boolean → TINYINT`

   ```javascript
   true → 1
   false → 0
   ```

3. **角色关联处理**:
   - 存储到 `menu_roles` 关联表
   - 支持多角色关联

---

## 五、常见问题

### Q1: "菜单名称" 和 "权限标识" 有什么区别？

**A**: 这是前端表单命名导致的容易混淆的地方：

| 前端表单显示 | 前端字段名 | 数据库字段 | 存储内容             | 示例                 |
| ------------ | ---------- | ---------- | -------------------- | -------------------- |
| **菜单名称** | `name`     | `title`    | 中文标题             | `区块链`、`用户管理` |
| **权限标识** | `label`    | `name`     | 英文路由名称（唯一） | `Blockchain`、`User` |

**关键理解**：

- 前端表单的"菜单名称"实际存储到数据库的 `title` 字段（中文）
- 前端表单的"权限标识"实际存储到数据库的 `name` 字段（英文，唯一标识）
- `name` 字段才是路由的真正唯一标识，用于 Vue Router 和权限控制

### Q2: 为什么一级菜单的组件路径要填 `/index/index`？

**A**:

- 这是项目的路由设计规范
- 一级菜单通常是一个布局容器，需要指向 `src/views/index/index.vue` 组件
- 该组件提供了统一的页面布局结构（包含侧边栏、内容区等）

### Q3: 什么时候应该隐藏菜单？

**A**: 以下场景应该启用"隐藏菜单"：

- 详情页（如用户详情、订单详情）
- 编辑页（如编辑文章）
- 不需要在导航栏显示的辅助页面
- **配合使用**: 同时配置 `activePath` 字段，指定高亮显示的父级菜单

### Q4: 角色权限在什么情况下生效？

**A**:

- **前端权限模式**: 需要配置 `roles` 字段，前端根据用户角色过滤菜单
- **后端权限模式**: 无需配置，后端根据用户角色返回可访问的菜单列表
- **当前项目**: 使用后端权限模式，角色权限存储在 `menu_roles` 表中

### Q5: 如何验证菜单是否创建成功？

**A**:

1. **前端验证**:
   - 刷新菜单管理页面，查看菜单列表
   - 前往侧边栏查看是否显示新菜单
2. **后端验证**:
   - 检查数据库 `menus` 表是否有新记录
   - 检查 `menu_roles` 表是否有角色关联记录
3. **API 验证**:
   ```bash
   # 获取菜单树
   GET http://localhost:3009/api/menus?mode=tree
   ```

### Q6: 删除菜单会发生什么？

**A**:

- ✅ **级联删除**: 删除父菜单时，所有子菜单会自动删除（数据库外键约束）
- ✅ **关联清理**: `menu_roles` 表中的关联记录会自动删除
- ⚠️ **不可恢复**: 删除操作不可逆，请谨慎操作

---

## 📚 相关文档

- [字段映射与转换规则.md](./字段映射与转换规则.md) - 详细的字段映射说明
- [API文档更新说明.md](./API文档更新说明.md) - 菜单管理 API 接口文档
- 数据库初始化脚本: `/scripts/init-database.sql`
- 后端控制器: `/backend/src/controllers/menu.controller.ts`
- 前端菜单组件: `/src/views/system/menu/index.vue`

---

**文档版本**: v1.0  
**更新时间**: 2025-01-18  
**维护者**: Art Design Pro Team

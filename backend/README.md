# Art Design Pro åç«¯ API æœåŠ¡

åŸºäº Node.js + Express + TypeScript + MySQL çš„åç«¯APIæœåŠ¡ã€‚

## ğŸ“‹ æŠ€æœ¯æ ˆ

- **Node.js**: è¿è¡Œæ—¶ç¯å¢ƒ
- **Express**: Webæ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨
- **MySQL**: æ•°æ®åº“
- **JWT**: èº«ä»½è®¤è¯
- **bcryptjs**: å¯†ç åŠ å¯†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
pnpm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åç«¯å·²é…ç½®å¥½ `.env` æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®ï¼š

- æœåŠ¡å™¨ç«¯å£ï¼š3009
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- JWTå¯†é’¥é…ç½®
- CORSè·¨åŸŸé…ç½®

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

æœåŠ¡å™¨å°†è¿è¡Œåœ¨ `http://localhost:3009`

### 4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm build
pnpm start
```

## ğŸ“¡ APIæ¥å£

### è®¤è¯æ¨¡å— (6ä¸ªæ¥å£)

- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/user/info` - è·å–ç”¨æˆ·ä¿¡æ¯
- `POST /api/auth/refresh-token` - åˆ·æ–°Token
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `GET /api/auth/check-username` - æ£€æŸ¥ç”¨æˆ·å

### ç”¨æˆ·ç®¡ç†æ¨¡å— (13ä¸ªæ¥å£)

**ä¸ªäººä¸­å¿ƒæ¥å£ï¼ˆ5ä¸ªï¼‰** - å½“å‰ç”¨æˆ·æ“ä½œè‡ªå·±çš„ä¿¡æ¯

- `GET /api/user/profile` - è·å–å½“å‰ç”¨æˆ·è¯¦æƒ…ï¼ˆåŒ…å«æ ‡ç­¾ï¼‰
- `PUT /api/user/profile` - æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯
- `POST /api/user/password` - ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç 
- `POST /api/user/tags` - æ›´æ–°å½“å‰ç”¨æˆ·æ ‡ç­¾
- `POST /api/user/avatar` - ä¸Šä¼ å½“å‰ç”¨æˆ·å¤´åƒ

**ç”¨æˆ·ç®¡ç†æ¥å£ï¼ˆ4ä¸ªï¼‰** - ç³»ç»Ÿç®¡ç†å‘˜ç®¡ç†æ‰€æœ‰ç”¨æˆ·ï¼ˆéœ€è¦R_SUPERæƒé™ï¼‰

- `GET /api/user/list` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/user` - åˆ›å»ºç”¨æˆ·
- `PUT /api/user/:id` - æ›´æ–°æŒ‡å®šç”¨æˆ·
- `DELETE /api/user/:id` - åˆ é™¤æŒ‡å®šç”¨æˆ·

### è§’è‰²ç®¡ç†æ¨¡å— (4ä¸ªæ¥å£)

- `GET /api/role/list` - è·å–è§’è‰²åˆ—è¡¨ (éœ€è¦R_SUPERæƒé™)
- `POST /api/role` - åˆ›å»ºè§’è‰² (éœ€è¦R_SUPERæƒé™)
- `PUT /api/role/:id` - æ›´æ–°è§’è‰² (éœ€è¦R_SUPERæƒé™)
- `DELETE /api/role/:id` - åˆ é™¤è§’è‰² (éœ€è¦R_SUPERæƒé™)

## ğŸ” è®¤è¯æœºåˆ¶

ä½¿ç”¨JWT (JSON Web Token) è¿›è¡Œèº«ä»½è®¤è¯ï¼š

- **Access Token**: æœ‰æ•ˆæœŸ30åˆ†é’Ÿ
- **Refresh Token**: æœ‰æ•ˆæœŸ7å¤©

è¯·æ±‚å¤´æ ¼å¼ï¼š

```
Authorization: Bearer {token}
```

## ğŸ—„ï¸ æ•°æ®åº“

- æ•°æ®åº“åï¼švirtualProject_dev
- åŒ…å«3å¼ æ ¸å¿ƒè¡¨ï¼šrolesã€usersã€user_tags
- é¢„ç½®3ä¸ªæµ‹è¯•è´¦å·ï¼šSuperã€Adminã€User
- åˆå§‹å¯†ç å‡ä¸ºï¼š123456

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ database.ts  # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”‚   â””â”€â”€ role.controller.ts
â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”‚   â””â”€â”€ error.middleware.ts
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.routes.ts
â”‚   â”‚   â”œâ”€â”€ user.routes.ts
â”‚   â”‚   â””â”€â”€ role.routes.ts
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ auth.util.ts
â”‚   â””â”€â”€ index.ts         # å…¥å£æ–‡ä»¶
â”œâ”€â”€ .env                 # ç¯å¢ƒå˜é‡
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸ”§ å¼€å‘è¯´æ˜

### æƒé™æ§åˆ¶

ç³»ç»Ÿæœ‰3ä¸ªè§’è‰²ï¼š

- **R_SUPER**: ç³»ç»Ÿåå°ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™
- **R_ADMIN**: ç³»ç»Ÿç®¡ç†å‘˜
- **R_USER**: æ™®é€šç”¨æˆ·

ä½¿ç”¨ä¸­é—´ä»¶è¿›è¡Œæƒé™æ§åˆ¶ï¼š

```typescript
// éœ€è¦è®¤è¯
router.get('/profile', authenticate, controller.getProfile)

// éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™
router.get('/list', authenticate, authorize('R_SUPER'), controller.getUserList)
```

### é”™è¯¯å¤„ç†

æ‰€æœ‰é”™è¯¯éƒ½é€šè¿‡ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶å¤„ç†ï¼Œè¿”å›æ ¼å¼ï¼š

```json
{
  "code": 400,
  "message": "é”™è¯¯ä¿¡æ¯"
}
```

### å“åº”æ ¼å¼

æˆåŠŸå“åº”æ ¼å¼ï¼š

```json
{
  "code": 200,
  "data": {},
  "message": "æ“ä½œæˆåŠŸ"
}
```

## ğŸŒ å‰ç«¯é›†æˆ

å‰ç«¯å·²é…ç½®ä»£ç†ï¼Œå°†æ‰€æœ‰ `/api` å¼€å¤´çš„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼š

```
VITE_API_PROXY_URL = http://localhost:3009
```

å‰ç«¯æœåŠ¡å™¨ç«¯å£ï¼š3008åç«¯æœåŠ¡å™¨ç«¯å£ï¼š3009

## ğŸ“ æ³¨æ„äº‹é¡¹

1. é¦–æ¬¡å¯åŠ¨éœ€ç¡®ä¿MySQLæ•°æ®åº“å·²åˆ›å»ºå¹¶æ‰§è¡Œäº†åˆå§‹åŒ–è„šæœ¬
2. JWTå¯†é’¥åœ¨ç”Ÿäº§ç¯å¢ƒéœ€è¦ä¿®æ”¹ä¸ºå¼ºå¯†é’¥
3. æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½éœ€è¦åˆ›å»º `uploads/` ç›®å½•
4. å»ºè®®ä½¿ç”¨pnpmä½œä¸ºåŒ…ç®¡ç†å™¨

## ğŸ› æ•…éšœæ’æŸ¥

### æ•°æ®åº“è¿æ¥å¤±è´¥

æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®ã€‚

### ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨3009ç«¯å£çš„è¿›ç¨‹å¹¶æ€æ‰
lsof -ti:3009 | xargs kill -9
```

### bcryptå®‰è£…å¤±è´¥

é¡¹ç›®å·²ä½¿ç”¨ `bcryptjs` æ›¿ä»£ `bcrypt`ï¼Œæ— éœ€ç¼–è¯‘ã€‚
